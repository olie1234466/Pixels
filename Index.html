<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PIXELS</title>
<style>
body {margin:0; background:black; font-family:Arial, sans-serif; overflow:hidden; display:flex; justify-content:center; align-items:center; height:100vh;}
canvas {display:none; border:3px solid white; background:#000; touch-action:none;}
#intro, #winScreen {position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; color:lime; text-align:center; z-index:10;}
#intro h1, #winScreen h1 {font-size:48px; margin:0;}
#intro p, #winScreen p {font-size:24px; margin-top:20px; color:white;}
</style>
</head>
<body>

<div id="intro">
<h1>PIXELS</h1>
<p>Click to Start</p>
</div>

<div id="winScreen" style="display:none;">
<h1>YOU WIN!</h1>
<p>Click to Continue</p>
</div>

<canvas id="game" width="400" height="400"></canvas>

<audio id="winMusic" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="loseMusic" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg"></audio>

<script>
const intro = document.getElementById("intro");
const winScreen = document.getElementById("winScreen");
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const winMusic = document.getElementById("winMusic");
const loseMusic = document.getElementById("loseMusic");

const groundY = 300;
const gravity = 0.6;

// Player
let player = { x:20, y:groundY-20, size:20, vx:0, vy:0, onGround:true, health:100 };
let gameStarted = false;
let currentLayout = 0;

// Pit
const pitX = 180;
const pitWidth = 60;

// Define 6 layouts (spikes + trees)
const layouts = [
  { spikes:[{x:50,width:20},{x:300,width:20}], trees:[{x:30,y:groundY-60,w:20,h:60},{x:320,y:groundY-70,w:20,h:70}] },
  { spikes:[{x:80,width:20},{x:250,width:20}], trees:[{x:60,y:groundY-50,w:20,h:50},{x:280,y:groundY-80,w:20,h:80}] },
  { spikes:[{x:120,width:20},{x:300,width:20}], trees:[{x:50,y:groundY-70,w:20,h:70},{x:310,y:groundY-60,w:20,h:60}] },
  { spikes:[{x:30,width:20},{x:200,width:20}], trees:[{x:10,y:groundY-60,w:20,h:60},{x:250,y:groundY-70,w:20,h:70}] },
  { spikes:[{x:150,width:20},{x:350,width:20}], trees:[{x:140,y:groundY-80,w:20,h:80},{x:330,y:groundY-60,w:20,h:60}] },
  { spikes:[{x:100,width:20},{x:280,width:20}], trees:[{x:90,y:groundY-50,w:20,h:50},{x:270,y:groundY-80,w:20,h:80}] }
];

// Current spikes/trees
let spikes = layouts[0].spikes;
let trees = layouts[0].trees;

// Start game
intro.addEventListener("click", ()=>{
  intro.style.display = "none";
  canvas.style.display = "block";
  gameStarted = true;
});

winScreen.addEventListener("click", ()=>{
  winScreen.style.display="none";
  currentLayout=0;
  resetPlayer();
});

// Swipe controls
let startX=0, startY=0;
canvas.addEventListener("touchstart", e=>{
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
});

canvas.addEventListener("touchend", e=>{
  let endX = e.changedTouches[0].clientX;
  let endY = e.changedTouches[0].clientY;
  let dx = endX - startX;
  let dy = endY - startY;

  if(dy<-30 && player.onGround){
    player.vy = -12;
    player.onGround = false;
    if(Math.abs(dx)>20) player.vx += dx>0?6:-6;
  } else if(Math.abs(dx) > Math.abs(dy)){
    player.vx += dx>0?4:-4;
  }
});

// Update
function update(){
  if(!gameStarted) return;
  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  // Pit
  if(player.x+player.size>pitX && player.x<pitX+pitWidth && player.y+player.size>=groundY){
    player.health = 0;
  }

  // Spikes
  for(let s of spikes){
    if(player.x+player.size>s.x && player.x<s.x+s.width && player.y+player.size>=groundY-10){
      player.health -= 50; // half health
      player.vy = -8; 
    }
  }

  // Ground collision
  if(player.y+player.size>=groundY){
    player.y = groundY - player.size;
    player.vy=0;
    player.onGround=true;
  }

  // Wall wrap
  if(player.x + player.size < 0 || player.x>canvas.width){
    currentLayout++;
    if(currentLayout>=6){
      // Win screen
      winScreen.style.display="flex";
      canvas.style.display="none";
      winMusic.play();
      return;
    }
    player.x = currentLayout%2===0?0:canvas.width - player.size; // spawn left or right
    player.vy=-12; // jump boost
    player.health = Math.max(player.health, 50); // keep health if possible
    // Load new layout
    spikes = layouts[currentLayout].spikes;
    trees = layouts[currentLayout].trees;
  }

  // Lose
  if(player.health <=0){
    loseMusic.play();
    resetPlayer();
  }

  // Friction
  player.vx *=0.9;
}

// Draw
function draw(){
  if(!gameStarted) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ground
  ctx.fillStyle="#888";
  ctx.fillRect(0,groundY,canvas.width,canvas.height-groundY);

  // Pit
  ctx.fillStyle="black";
  ctx.fillRect(pitX,groundY,pitWidth,canvas.height-groundY);

  // Trees
  ctx.fillStyle="green";
  for(let t of trees){
    ctx.fillRect(t.x,t.y,t.w,t.h);
  }

  // Spikes
  ctx.fillStyle="red";
  for(let s of spikes){
    ctx.beginPath();
    ctx.moveTo(s.x, groundY);
    ctx.lineTo(s.x+s.width/2, groundY-20);
    ctx.lineTo(s.x+s.width, groundY);
    ctx.closePath();
    ctx.fill();
  }

  // Player
  ctx.fillStyle="lime";
  ctx.fillRect(player.x,player.y,player.size,player.size);

  // Health bar
  ctx.fillStyle="red";
  ctx.fillRect(10,10,player.health*2,20);
  ctx.strokeStyle="white";
  ctx.strokeRect(10,10,200,20);
}

// Loop
function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

function resetPlayer(){
  player.x = 20;
  player.y = groundY-20;
  player.vx=0;
  player.vy=0;
  player.onGround=true;
  player.health =100;
  currentLayout = 0;
  spikes = layouts[0].spikes;
  trees = layouts[0].trees;
}

loop();
</script>

</body>
</html>
