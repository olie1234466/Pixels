<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PIXELS ULTIMATE</title>
<style>
body {margin:0; background:black; font-family:Arial, sans-serif; overflow:hidden; display:flex; justify-content:center; align-items:center; height:100vh;}
canvas {border:3px solid white; background:#000; display:none; touch-action:none;}
#intro, #shopScreen, #winScreen, #loseScreen {position:absolute; top:0; left:0; width:100%; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center; color:lime; text-align:center; z-index:10;}
h1 {font-size:48px;margin:0;}
p {font-size:24px;margin-top:20px;color:white;}
.button {width:80px;height:60px;background:green;margin:10px;cursor:pointer;display:flex;justify-content:center;align-items:center;color:black;font-weight:bold;}
#shopContainer {display:flex;flex-wrap:wrap;justify-content:center;align-items:center;margin-top:20px;}
.skin {width:40px;height:40px;margin:5px;border:2px solid white;cursor:pointer;display:flex;justify-content:center;align-items:center;}
</style>
</head>
<body>

<div id="intro">
<h1>PIXELS</h1>
<div class="button" id="startBtn">Start</div>
<div class="button" id="shopBtn">Shop</div>
</div>

<div id="shopScreen" style="display:none;">
<h1>SHOP</h1>
<p>Click skin to select</p>
<div id="shopContainer"></div>
<div class="button" id="backBtn">Back</div>
</div>

<div id="winScreen" style="display:none;">
<h1>YOU WIN!</h1>
<div class="button" id="endlessBtn">Endless</div>
<p>Click to continue</p>
</div>

<div id="loseScreen" style="display:none;">
<h1>YOU LOSE!</h1>
<p>Your score: <span id="finalScore">0</span></p>
<div class="button" id="restartBtn">Restart</div>
</div>

<canvas id="game" width="400" height="400"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const intro = document.getElementById("intro");
const shopScreen = document.getElementById("shopScreen");
const winScreen = document.getElementById("winScreen");
const endlessBtn = document.getElementById("endlessBtn");
const loseScreen = document.getElementById("loseScreen");
const finalScoreDisplay = document.getElementById("finalScore");

let highscore = 0;
let endlessMode = false;

// Skins
let currentSkin = {color:'lime', eyes:true};
const skins = [
  {color:'lime', eyes:true}, {color:'red', eyes:false}, {color:'blue', eyes:true},
  {color:'orange', eyes:false}, {color:'purple', eyes:true}, {color:'pink', eyes:true},
  {color:'cyan', eyes:false}, {color:'yellow', eyes:true}, {color:'white', eyes:true},
  {color:'brown', eyes:false}
];

// Player
const groundY = 300;
const gravity = 0.6;
let player = {x:20, y:groundY-20, size:20, vx:0, vy:0, onGround:true};

// Score & Lives
let score = 0;
let lives = 3;

// Layouts
const layouts = [
  { spikes:[{x:120,width:20},{x:300,width:20}], trees:[{x:30,y:groundY-60,w:20,h:60},{x:320,y:groundY-70,w:20,h:70}] },
  { spikes:[{x:130,width:20},{x:250,width:20}], trees:[{x:60,y:groundY-50,w:20,h:50},{x:280,y:groundY-80,w:20,h:80}] },
  { spikes:[{x:140,width:20},{x:300,width:20}], trees:[{x:50,y:groundY-70,w:20,h:70},{x:310,y:groundY-60,w:20,h:60}] },
  { spikes:[{x:150,width:20},{x:240,width:20}], trees:[{x:10,y:groundY-60,w:20,h:60},{x:250,y:groundY-70,w:20,h:70}] }, // fixed stage 4
  { spikes:[{x:160,width:20},{x:330,width:20}], trees:[{x:140,y:groundY-80,w:20,h:80},{x:330,y:groundY-60,w:20,h:60}] },
  { spikes:[{x:120,width:20},{x:280,width:20}], trees:[{x:90,y:groundY-50,w:20,h:50},{x:270,y:groundY-80,w:20,h:80}] }
];

let currentLayout = 0;
let spikes = layouts[0].spikes;
let trees = layouts[0].trees;
let jumpedSpikes = []; // track spikes passed for points

// Controls
let startX=0,startY=0;
canvas.addEventListener("touchstart", e=>{startX=e.touches[0].clientX; startY=e.touches[0].clientY;});
canvas.addEventListener("touchend", e=>{
  let dx=e.changedTouches[0].clientX-startX;
  let dy=e.changedTouches[0].clientY-startY;
  if(dy<-30 && player.onGround){player.vy=-12;player.onGround=false; if(Math.abs(dx)>20) player.vx+=dx>0?6:-6;}
  else if(Math.abs(dx)>Math.abs(dy)){player.vx+=dx>0?4:-4;}
});

// Buttons
document.getElementById("startBtn").addEventListener("click", ()=>{intro.style.display='none'; canvas.style.display='block'; startGame();});
document.getElementById("shopBtn").addEventListener("click", ()=>{intro.style.display='none'; shopScreen.style.display='flex'; loadShop();});
document.getElementById("backBtn").addEventListener("click", ()=>{shopScreen.style.display='none'; intro.style.display='flex';});
endlessBtn.addEventListener("click", ()=>{winScreen.style.display='none'; endlessMode=true; startGame();});
document.getElementById("restartBtn").addEventListener("click", ()=>{loseScreen.style.display='none'; startGame();});

// Shop
const shopContainer = document.getElementById("shopContainer");
function loadShop(){
  shopContainer.innerHTML="";
  skins.forEach((s,i)=>{
    const div = document.createElement("div");
    div.className="skin";
    div.style.background=s.color;
    div.innerHTML = s.eyes?"ðŸ‘€":"";
    div.addEventListener("click", ()=>{currentSkin = {...s}; alert("Skin selected!");});
    shopContainer.appendChild(div);
  });
}

// Game functions
function startGame(){
  score = 0;
  lives = 3;
  currentLayout = 0;
  player.x=20; player.y=groundY-20; player.vx=0; player.vy=0; player.onGround=true;
  spikes = layouts[currentLayout].spikes;
  trees = layouts[currentLayout].trees;
  jumpedSpikes = [];
  canvas.style.display='block';
}

// Update
function update(){
  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  // Ground
  if(player.y+player.size>=groundY){player.y=groundY-player.size;player.vy=0;player.onGround=true;}

  // Pit
  const pitX=180, pitWidth=60;
  if(player.x+player.size>pitX && player.x<pitX+pitWidth && player.y+player.size>=groundY){
    loseLife();
    return;
  }

  // Spikes
  spikes.forEach((s,i)=>{
    // Collision â†’ lose life
    if(player.x+player.size>s.x && player.x<s.x+s.width && player.y+player.size>=groundY-10){
      loseLife();
    }
    // Passed spike â†’ +50 points
    else if(player.x > s.x + s.width && !jumpedSpikes[i]){
      score += 50;
      jumpedSpikes[i] = true;
    }
  });

  // Wall wrap â†’ next layout
  if(player.x+player.size<0 || player.x>canvas.width){
    score += 100; // level complete
    currentLayout++;
    if(currentLayout>=6){
      winScreen.style.display='flex';
      canvas.style.display='none';
      if(score>highscore) highscore=score;
      return;
    }
    resetLayout();
    spikes = layouts[currentLayout].spikes;
    trees = layouts[currentLayout].trees;
  }

  // Friction
  player.vx*=0.9;
}

// Lose life
function loseLife(){
  lives--;
  if(lives<=0){
    finalScoreDisplay.innerText = score;
    loseScreen.style.display='flex';
    canvas.style.display='none';
    if(score>highscore) highscore=score;
  } else {
    resetLayout();
  }
}

// Reset layout after life lost
function resetLayout(){
  player.x=20; player.y=groundY-20; player.vx=0; player.vy=0; player.onGround=true;
  jumpedSpikes = []; // reset spike scoring
}

// Draw
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ground
  ctx.fillStyle="#888"; ctx.fillRect(0,groundY,canvas.width,canvas.height-groundY);

  // Pit
  ctx.fillStyle="black"; ctx.fillRect(180,groundY,60,canvas.height-groundY);

  // Trees
  ctx.fillStyle="green";
  trees.forEach(t=>ctx.fillRect(t.x,t.y,t.w,t.h));

  // Spikes
  ctx.fillStyle="red";
  spikes.forEach(s=>{
    ctx.beginPath(); ctx.moveTo(s.x,groundY); ctx.lineTo(s.x+s.width/2,groundY-20); ctx.lineTo(s.x+s.width,groundY); ctx.closePath(); ctx.fill();
  });

  // Player
  ctx.fillStyle=currentSkin.color;
  ctx.fillRect(player.x,player.y,player.size,player.size);
  if(currentSkin.eyes){
    ctx.fillStyle="white"; ctx.fillRect(player.x+4,player.y+4,4,4); ctx.fillRect(player.x+12,player.y+4,4,4);
  }

  // Score & Lives
  ctx.fillStyle='white';
  ctx.font='16px Arial';
  ctx.fillText(`Score: ${score}`, 10, 20);
  ctx.fillText(`Highscore: ${highscore}`, 10, 40);
  ctx.fillText(`Lives: ${lives}`, canvas.width-80, 20);
}

// Loop
function loop(){update(); draw(); requestAnimationFrame(loop);}
loop();
</script>

</body>
</html>
