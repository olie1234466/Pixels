<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PIXELS</title>
<style>
body {margin:0; background:black; font-family:Arial, sans-serif; overflow:hidden; display:flex; justify-content:center; align-items:center; height:100vh;}
canvas {display:none; border:3px solid white; background:#000; touch-action:none;}
#intro {position:absolute; top:0; left:0; width:100%; height:100%; background:black; display:flex; flex-direction:column; justify-content:center; align-items:center; color:lime; z-index:10; text-align:center;}
#intro h1 {font-size:48px; margin:0;}
#intro p {font-size:24px; margin-top:20px; color:white;}
</style>
</head>
<body>

<div id="intro">
<h1>PIXELS</h1>
<p>Tap to Start</p>
</div>

<canvas id="game" width="400" height="400"></canvas>

<audio id="winMusic" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="loseMusic" src="https://actions.google.com/sounds/v1/cartoon/boing.ogg"></audio>

<script>
const intro = document.getElementById("intro");
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const winMusic = document.getElementById("winMusic");
const loseMusic = document.getElementById("loseMusic");

const groundY = 300;

// Player setup (start slightly right from edge)
let player = { x:20, y:groundY-20, size:20, vx:0, vy:0, onGround:true, health:100 };
const gravity = 0.6;
let startX=0, startY=0;
let gameStarted = false;
let wallWraps = 0;

// Pit (smaller)
const pitX = 180;
const pitWidth = 60;

// Spikes (fewer, avoiding pit edges)
const spikes = [
  {x:50, width:20},
  {x:300, width:20}
];

// Trees
const trees = [
  {x:30, y:groundY-60, width:20, height:60},
  {x:180, y:groundY-80, width:20, height:80},
  {x:320, y:groundY-70, width:20, height:70}
];

// Start game
intro.addEventListener("click", ()=>{
  intro.style.display = "none";
  canvas.style.display = "block";
  gameStarted = true;
});

// Swipe controls
canvas.addEventListener("touchstart", e=>{
  if(!gameStarted) return;
  startX = e.touches[0].clientX;
  startY = e.touches[0].clientY;
});

canvas.addEventListener("touchend", e=>{
  if(!gameStarted) return;
  let endX = e.changedTouches[0].clientX;
  let endY = e.changedTouches[0].clientY;
  let dx = endX - startX;
  let dy = endY - startY;

  if(dy<-30 && player.onGround){
    player.vy = -12;
    player.onGround = false;
    if(Math.abs(dx)>20) player.vx += dx>0?6:-6; // diagonal boost
  } else if(Math.abs(dx) > Math.abs(dy)){
    player.vx += dx>0?4:-4;
  }
});

function update(){
  if(!gameStarted) return;
  player.vy += gravity;
  player.x += player.vx;
  player.y += player.vy;

  // Pit
  if(player.x+player.size>pitX && player.x<pitX+pitWidth && player.y+player.size>=groundY){
    player.health = 0;
    loseMusic.play();
    resetGame();
  }

  // Spikes collision
  for(let s of spikes){
    if(player.x+player.size>s.x && player.x<s.x+s.width && player.y+player.size>=groundY-10){
      player.health -= 50; 
      player.vy = -8; 
      if(player.health<=0){
        loseMusic.play();
        resetGame();
      }
    }
  }

  // Ground collision
  if(player.y + player.size >= groundY){
    player.y = groundY - player.size;
    player.vy = 0;
    player.onGround = true;
  }

  // Wrap-around walls
  if(player.x + player.size < 0){ 
    player.x = canvas.width - player.size;
    wallWraps++;
    player.vy = -12; // jump boost
  }
  if(player.x > canvas.width){
    player.x = 0;
    wallWraps++;
    player.vy = -12; 
  }

  // Win condition
  if(wallWraps >= 6){
    winMusic.play();
    alert("YOU WIN!");
    resetGame();
  }

  // Friction
  player.vx *= 0.9;
}

function draw(){
  if(!gameStarted) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Ground
  ctx.fillStyle="#888";
  ctx.fillRect(0,groundY,canvas.width,canvas.height-groundY);

  // Pit
  ctx.fillStyle="black";
  ctx.fillRect(pitX, groundY, pitWidth, canvas.height-groundY);

  // Trees
  ctx.fillStyle="green";
  for(let t of trees){
    ctx.fillRect(t.x, t.y, t.width, t.height);
  }

  // Spikes
  ctx.fillStyle="red";
  for(let s of spikes){
    ctx.beginPath();
    ctx.moveTo(s.x, groundY);
    ctx.lineTo(s.x+s.width/2, groundY-20);
    ctx.lineTo(s.x+s.width, groundY);
    ctx.closePath();
    ctx.fill();
  }

  // Player
  ctx.fillStyle="lime";
  ctx.fillRect(player.x, player.y, player.size, player.size);

  // Health bar
  ctx.fillStyle="red";
  ctx.fillRect(10,10,player.health*2,20);
  ctx.strokeStyle="white";
  ctx.strokeRect(10,10,200,20);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

function resetGame(){
  player.x=20;
  player.y=groundY-20;
  player.vx=0;
  player.vy=0;
  player.onGround=true;
  player.health=100;
  wallWraps=0;
}

loop();
</script>

</body>
</html>
